<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel='stylesheet' href='stylesheets/fontawesome/css/fontawesome.min.css'>
    <link rel='stylesheet' href='stylesheets/semantic.min.css'>
    <link rel='stylesheet' href='stylesheets/application.css'>
  </head>
  <body>
   
    <div id="webSearch">
      <div class="ui action input fluid disabled">
        <input type="text" id="website" placeholder="Paste Website URL to Screenshot...">
      </div>
      <div class="ui buttons fluid" id="buttonBar">
        <div class="ui button blue disabled" id="takeDesktop"><i class="fas fa-desktop"></i></div>
        <div class="ui button blue disabled" id="takeMobile"><i class="fas fa-mobile-alt"></i></div>
        <div class="ui button blue disabled" id="takeThumbnail"><i class="far fa-image"></i></div>
        <div class="ui button blue" id="settings"><i class="far fa-folder-open"></i></div>
      </div>
    </div>

    <div id="loading" style="display: none">
      <i class="far fa-spinner fa-spin"></i>
    </div>


    <script>
      // Environment Variables from .env file
      require('dotenv').config()

      // Electron
      const { ipcRenderer, shell, clipboard, ipcMain } = require('electron')
      const dialog = require('electron').remote.dialog
      const nativeImage = require('electron').nativeImage
      const path = require('path')
      const fs = require('fs')
      const isDev = require('electron-is-dev')
      const isUrl = require("is-url")

      // Screenshots
      const puppeteer = require('puppeteer')
      const devices = require('puppeteer/DeviceDescriptors')
      const iPhone = devices['iPhone 6']

      // Load jQuery
      window.$ = window.jQuery = require('jquery')

      // Storage
      const Store = require('electron-store')
      const store = new Store()

      if (store.get('myFolderPath')) {
        $('.button, .input').removeClass('disabled')
      } else {
        store.set('myFolderPath', dialog.showOpenDialog({ properties: ['openDirectory'] })[0]) 
      }

      // Clear storage on test
      if (process.env.MOCHA) { // --> clear storage if tests
        store.clear()
      }

      // General Components
      const component = require(path.join(__dirname, 'javascripts/components'))

      // Views
      const example_view = fs.readFileSync(path.join(__dirname, 'views/example.html'), 'utf8')

      window.onfocus = function() {
        let clipz = clipboard.readText('selection')
        if (isUrl(clipz)) {
          $('#website').val(clipz)
        } else {
          $('#website').focus()
        }
      }

      window.onblur = function() {
        ipcRenderer.send('de-activated')
        $('#website').val('')
        $('#loading').hide()
        $('#webSearch').show()
      }

      require('./renderer.js')
    </script>
  </body>
</html>
