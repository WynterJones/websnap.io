<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel='stylesheet' href='stylesheets/fontawesome/css/fontawesome.min.css'>
    <link rel='stylesheet' href='stylesheets/semantic.min.css'>
    <link rel='stylesheet' href='stylesheets/application.css'>
  </head>
  <body>
   
    <div id="webSearch">
      <div class="ui action input loading fluid">
          <input type="text" id="website" placeholder="Website URL...">
          <div class="ui button blue" id="takeDesktop"><i class="fas fa-desktop"></i></div>
          <div class="ui button blue" id="takeMobile"><i class="fas fa-mobile-alt"></i></div>
          <div class="ui button blue" id="takeThumbnail"><i class="far fa-image"></i></div>
          <!-- <div class="ui button blue" id="websiteButton"><i class="far fa-camera-alt"></i></div> -->
        </div>
    </div>


    <script>
      // Environment Variables from .env file
      require('dotenv').config()

      // Electron
      const { ipcRenderer, shell, clipboard, ipcMain } = require('electron')
      const dialog = require('electron').remote.dialog
      const path = require('path')
      const fs = require('fs')
      const isDev = require('electron-is-dev')

      // Screenshots
      const puppeteer = require('puppeteer')
      const devices = require('puppeteer/DeviceDescriptors')
      const iPhone = devices['iPhone 6']
      
      function getChromiumExecPath() {
        return puppeteer.executablePath().replace('app.asar', 'app.asar.unpacked');
      }

      const browser =  puppeteer.launch({executablePath: getChromiumExecPath()});
      const nativeImage = require('electron').nativeImage

      // Load jQuery
      window.$ = window.jQuery = require('jquery')

      // Storage
      const Store = require('electron-store')
      const store = new Store()

      if (!store.get('myFolderPath')) {
        store.set('myFolderPath', dialog.showOpenDialog({ properties: ['openDirectory'] })[0]) 
      }
      const FOLDER_PATH = store.get('myFolderPath')

      fs.mkdir(`${FOLDER_PATH}/fullsize`, function (err) {})
      fs.mkdir(`${FOLDER_PATH}/thumbnails`, function (err) {})

      // Clear storage on test
      if (process.env.MOCHA) { // --> clear storage if tests
        store.clear()
      }

      // General Components
      const component = require(path.join(__dirname, 'javascripts/components'))

      // Views
      const example_view = fs.readFileSync(path.join(__dirname, 'views/example.html'), 'utf8')

      window.onfocus = function() {
        let clipz = clipboard.readText('selection')
        if (validURL(clipz)) {
          $('#website').val(clipz)
        }
      }

      window.onblur = function() {
        ipcRenderer.send('de-activated')
      }

      function validURL(str) {
        var pattern = new RegExp('^(https?:\\/\\/)?'+ // protocol
          '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+ // domain name
          '((\\d{1,3}\\.){3}\\d{1,3}))'+ // OR ip (v4) address
          '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ // port and path
          '(\\?[;&a-z\\d%_.~+=-]*)?'+ // query string
          '(\\#[-a-z\\d_]*)?$','i'); // fragment locator
        return !!pattern.test(str);
      }

      require('./renderer.js')
    </script>
  </body>
</html>
